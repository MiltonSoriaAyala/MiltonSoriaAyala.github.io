---
title: Practica 01 sobre Kill Chain
date: 2024-10-10 00:00:00 +05:00
categories: [reconnaisance, kill chain, pentesting]
tags: [nmap, kali, metaxploid, SSH, vssown, handshake]  # TAG names should always be lowercase
---

# **¿Qué es Cyber Security Kill Chain?**

El modelo de la Kill Chain de la ciberseguridad explica el procedimiento típico que siguen los ciberdelincuentes para completar un ataque cibernético con éxito. Se trata de un marco desarrollado por Lockheed Martin, derivado de los modelos de ataque militares y trasladado al mundo digital para ayudar a los equipos a comprender, detectar y prevenir las ciberamenazas persistentes. Aunque no todos los ciberataques aplicarán los siete pasos del modelo de la Kill Chain de la ciberseguridad, la inmensa mayoría de los ataques los utilizan casi todos, a menudo abarcando del paso 2 al paso 6.

![figure](/assets/images/killChain.png) 
fuente: **[https://www.netskope.com/es/security-defined/cyber-security-kill-chain](https://www.netskope.com/es/security-defined/cyber-security-kill-chain)**

# Pasos típicos del Kill Chain en Ciberseguridad

## Paso 1: Reconocimiento
Los ciberataques más efectivos inician con una fase de reconocimiento, donde los atacantes realizan una recopilación exhaustiva de información sobre su objetivo. Esta etapa implica el uso de herramientas avanzadas y técnicas, como motores de búsqueda, análisis de metadata, servicios en la nube y protocolos de red (como WHOIS y DNS). Los atacantes buscan identificar vulnerabilidades en aplicaciones, redes y bases de datos especialmente aquellas alojadas en la nube—exponiendo puntos débiles que podrían ser explotados en etapas posteriores. Proteger la información sensible mediante prácticas como el cifrado robusto y la implementación de defensas en la nube es crucial para mitigar el riesgo de que los atacantes accedan a datos confidenciales.

## Paso 2: Preparación
Tras reunir suficiente información, los atacantes seleccionan vectores de ataque específicos para llevar a cabo la intrusión. Un vector de ataque es un método o técnica utilizada para obtener acceso no autorizado, y los ciberdelincuentes evalúan el costo y el retorno potencial de cada objetivo, optando generalmente por las rutas de menor resistencia. Los vectores comunes incluyen credenciales inseguras, acceso remoto sin protección (RDP, SSH), y ataques de ingeniería social como el phishing. Esto subraya la importancia de realizar auditorías de seguridad y reforzar todos los puntos de acceso potencialmente vulnerables en la infraestructura.

## Paso 3: Distribución
Una vez dentro del sistema, los atacantes tienen la capacidad de distribuir cargas maliciosas, como malware o ransomware, configurando ataques que pueden ser inmediatos o programados. Con un creciente porcentaje de estos ataques llevándose a cabo a través de la nube, es esencial implementar servicios de escaneo de amenazas y análisis de comportamiento en tiempo real. Monitorear el tráfico web y en la nube, así como la salud de los dispositivos de endpoint, se vuelve indispensable para garantizar que la red permanezca libre de infecciones y que las amenazas sean neutralizadas antes de causar daños.

## Paso 4: Explotación
Después de la distribución del malware, el atacante inicia la explotación del sistema, que puede ocurrir de forma inmediata o ser desencadenada por acciones específicas del usuario, como ejecutar un archivo adjunto malicioso. Estos programas a menudo emplean técnicas de ofuscación y evasión para ocultar su actividad, dificultando su detección por parte de las soluciones de seguridad. Esta fase es crítica, ya que el éxito de la explotación puede permitir al atacante obtener acceso a datos sensibles o comprometer aún más la infraestructura de TI.

## Paso 5: Instalación
Si el atacante busca mantener un acceso persistente, procederá a instalar una puerta trasera que le permita reingresar al sistema sin ser detectado. Estas puertas traseras pueden ser configuradas mediante rootkits o aprovechando credenciales débiles. La detección de estas intrusiones es particularmente complicada, ya que pueden operar en silencio y sin generar alertas evidentes. Por ello, es fundamental contar con una arquitectura de seguridad integral que incluya monitoreo de logs, análisis de comportamiento y detección de anomalías para identificar intrusiones.

## Paso 6: Comando y Control
Con el malware y las puertas traseras instaladas, el atacante establece un canal de comando y control para gestionar sus operaciones dentro del sistema comprometido. Este control permite al atacante ejecutar acciones maliciosas, como la instalación de ransomware o la exfiltración de datos. La implementación de medidas de seguridad que supervisen el tráfico de red y analicen patrones de comportamiento se vuelve esencial, ya que detectar actividades inusuales de forma proactiva puede prevenir la escalada del ataque y limitar el daño potencial.

## Paso 7: Acciones sobre los Objetivos
Finalmente, en esta fase crítica, el atacante lleva a cabo acciones específicas sobre el objetivo, que pueden incluir el cifrado de datos para exigir un rescate, la exfiltración de información sensible o la ejecución de ataques de denegación de servicio. La vigilancia y el espionaje son tácticas comunes en esta etapa, lo que hace imperativo que las organizaciones implementen un monitoreo continuo y análisis en tiempo real de las actividades en sus sistemas. Una respuesta proactiva y bien estructurada ante anomalías puede ser decisiva para mitigar el impacto de un ataque y proteger los activos críticos de la organización.

# **Desarrollo del laboratorio Kill Chain**

A continiación se detalla paso a paso el desarrollo del laboratorio de clase, las mismas que van a ir acompañados de las respuestas a las preguntas de la Práctca 01 (P01-Kill Chain).

## **Etapa 1: Reconnaissance**

Identificamos la ip del target:


Ejecutamos el comando ipconfig en el PowerShell de Windows:
```shell
ipconfig
```
Aqui identificamos la ip del objetivo (10.0.2.4) 
![figure](/assets/images/ipconfig.jpeg)



Ejecutamos el comando:
```bash
sudo nmap -sV -p- 10.0.2.4
```

![figure](/assets/images/nmap1.jpeg)

El comando que se muestra en la figura está utilizando `nmap` para realizar un escaneo de puertos en un host específico (10.0.2.4). A continuación explico cada parte del comando y lo que está realizando:

### Desglose del Comando

1. **`sudo`**: Este comando se utiliza para ejecutar `nmap` con privilegios de superusuario (root). Esto permite que `nmap` realice operaciones avanzadas que requieren acceso completo a la red.
2. **`nmap`**: Es la herramienta que se está utilizando para escanear la red y los puertos.
3. **`-p-`**: Esto indica que se escanearán todos los puertos (del 1 al 65535). Esto es útil para obtener un panorama completo de los servicios que están escuchando en el host.
4. **`-sV`**: Este flag se utiliza para detectar versiones de los servicios que se están ejecutando en los puertos abiertos.
5. **`10.0.2.4`**: Este es el objetivo del escaneo, que es la dirección IP del host que se está analizando.

### Resultados del Escaneo

- **`PORT`**: Muestra los puertos que han sido escaneados.
- **`STATE`**: Indica si el puerto está abierto, cerrado o filtrado.
- **`SERVICE`**: Muestra el servicio que se está ejecutando en cada puerto.

### Resultado del Escaneo para SSH

- **Puerto**: `22/tcp`
- **Estado**: `open`
- **Servicio**: `OpenSSH 7.9p1 (protocol 2.0)`

### Interpretación

1. **Puerto 22/tcp**: Este es el puerto estándar utilizado para el servicio SSH (Secure Shell), que proporciona una comunicación segura entre un cliente y un servidor.

2. **Estado `open`**: Indica que el puerto está abierto y que el servicio SSH está escuchando en ese puerto. Esto significa que se puede establecer una conexión SSH con el servidor.

3. **Servicio `OpenSSH 7.9p1 (protocol 2.0)`**: Identifica que el servicio en ejecución es OpenSSH, específicamente la versión 7.9p1, y que está utilizando el protocolo SSH 2.0. Esto es relevante para la seguridad, ya que las versiones más recientes suelen incluir mejoras y parches de seguridad.

### Conclusión

El escaneo ha identificado que el servicio SSH está activo y accesible en el servidor escaneado, lo que permite la conexión remota y segura a través de SSH.

## **Etapa 2: Weaponization**

### Uso de Metasploit Framework

Metasploit Framework es una herramienta de código abierto utilizada principalmente para pruebas de penetración y la explotación de vulnerabilidades en sistemas informáticos. Ofrece una extensa colección de módulos de exploits, payloads (códigos que se ejecutan en el sistema objetivo tras una explotación exitosa), y herramientas para escanear redes en busca de vulnerabilidades. Además, incluye módulos auxiliares para tareas como el escaneo de puertos y la recolección de información, y cuenta con tanto una interfaz de línea de comandos (`msfconsole`) como interfaces gráficas. Es fundamental en el campo de la ciberseguridad, permitiendo a los profesionales simular ataques reales, identificar debilidades y mejorar la defensa de infraestructuras tecnológicas, aunque su uso debe ser ético, legal y debe ser realizado en entornos controlados.

Sus principales usos son:

- **Pruebas de Penetración**: Metasploit es ampliamente utilizado por profesionales de la seguridad para identificar y explotar vulnerabilidades en sistemas.
- **Desarrollo de Exploits**: Proporciona un entorno para desarrollar y probar exploits.
- **Módulos de Exploit**: Contiene una extensa base de datos de exploits, payloads y herramientas para realizar diversas tareas de seguridad.
- **Manejo de Sesiones**: Permite gestionar sesiones de explotación y establecer conexiones de control sobre sistemas comprometidos.

### Desglose del Comando: msfconsole -q

1. **`msfconsole`**: Es la interfaz de línea de comandos de Metasploit. Permite a los usuarios interactuar con el framework para realizar tareas como escaneo, explotación y manejo de sesiones.

2. **`-q`**: Esta opción significa "quiet mode", o modo silencioso. Al usar esta opción, Metasploit inicia sin mostrar el banner de bienvenida y sin mensajes adicionales que normalmente aparecen al iniciar. Esto puede ser útil para aquellos que desean una experiencia más limpia o para scripts automatizados.

Luego de una previa explicación del comando, continuamos con el laboratorio y ejecutamos el comando:
```bash
msfconsole -q
```

![figure](/assets/images/msfconsole.jpeg)


```ruby
search ssh enum
```

![figure](/assets/images/enum.jpeg)

```ruby
use auxiliary(scanner/ssh/ssh_enumusers):
set RHOSTS 10.0.2.4
set USER_FILE /home/user/Downloads/CommonAdminBase64.txt
set VERBOSE true
show options
run
```
![figure](/assets/images/enum3.png)
![figure](/assets/images/run1.png)
![figure](/assets/images/run2.png)

```ruby
search ssh login
```

![figure](/assets/images/sshlogin.jpeg)

```ruby
use auxiliary(scanner/ssh/ssh_login):
set RHOSTS 10.0.2.4
set USER_FILE /home/user/Downloads/usewrname.txt
set PASS_FILE /home/user/Downloads/top-usernames-shortlist.txt
set VERBOSE true
show options
run
```
![figure](/assets/images/login2.png)
![figure](/assets/images/login3.png)
![figure](/assets/images/login4.png)



